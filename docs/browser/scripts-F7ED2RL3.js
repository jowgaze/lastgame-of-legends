/*! dom-to-image 10-06-2017 */(function(H){"use strict";function b(n,t){function r(i){return t.bgcolor&&(i.style.backgroundColor=t.bgcolor),t.width&&(i.style.width=t.width+"px"),t.height&&(i.style.height=t.height+"px"),t.style&&Object.keys(t.style).forEach(function(s){i.style[s]=t.style[s]}),i}return t=t||{},O(t),Promise.resolve(n).then(function(i){return k(i,t.filter,!0)}).then(X).then(G).then(r).then(function(i){return z(i,t.width||a.width(n),t.height||a.height(n))})}function N(n,t){return j(n,t||{}).then(function(r){return r.getContext("2d").getImageData(0,0,a.width(n),a.height(n)).data})}function F(n,t){return j(n,t||{}).then(function(r){return r.toDataURL()})}function $(n,t){return t=t||{},j(n,t).then(function(r){return r.toDataURL("image/jpeg",t.quality||1)})}function q(n,t){return j(n,t||{}).then(a.canvasToBlob)}function O(n){typeof n.imagePlaceholder>"u"?E.impl.options.imagePlaceholder=I.imagePlaceholder:E.impl.options.imagePlaceholder=n.imagePlaceholder,typeof n.cacheBust>"u"?E.impl.options.cacheBust=I.cacheBust:E.impl.options.cacheBust=n.cacheBust}function j(n,t){function r(i){var s=document.createElement("canvas");if(s.width=t.width||a.width(i),s.height=t.height||a.height(i),t.bgcolor){var c=s.getContext("2d");c.fillStyle=t.bgcolor,c.fillRect(0,0,s.width,s.height)}return s}return b(n,t).then(a.makeImage).then(a.delay(100)).then(function(i){var s=r(n);return s.getContext("2d").drawImage(i,0,0),s})}function k(n,t,r){function i(o){return o instanceof HTMLCanvasElement?a.makeImage(o.toDataURL()):o.cloneNode(!1)}function s(o,l,g){function x(L,p,m){var w=Promise.resolve();return p.forEach(function(U){w=w.then(function(){return k(U,m)}).then(function(y){y&&L.appendChild(y)})}),w}var d=o.childNodes;return d.length===0?Promise.resolve(l):x(l,a.asArray(d),g).then(function(){return l})}function c(o,l){function g(){function p(m,w){function U(y,T){a.asArray(y).forEach(function(e){T.setProperty(e,y.getPropertyValue(e),y.getPropertyPriority(e))})}m.cssText?w.cssText=m.cssText:U(m,w)}p(window.getComputedStyle(o),l.style)}function x(){function p(m){function w(u,f,h){function P(A){var S=A.getPropertyValue("content");return A.cssText+" content: "+S+";"}function C(A){function S(R){return R+": "+A.getPropertyValue(R)+(A.getPropertyPriority(R)?" !important":"")}return a.asArray(A).map(S).join("; ")+";"}var v="."+u+":"+f,B=h.cssText?P(h):C(h);return document.createTextNode(v+"{"+B+"}")}var U=window.getComputedStyle(o,m),y=U.getPropertyValue("content");if(y!==""&&y!=="none"){var T=a.uid();l.className=l.className+" "+T;var e=document.createElement("style");e.appendChild(w(T,m,U)),l.appendChild(e)}}[":before",":after"].forEach(function(m){p(m)})}function d(){o instanceof HTMLTextAreaElement&&(l.innerHTML=o.value),o instanceof HTMLInputElement&&l.setAttribute("value",o.value)}function L(){l instanceof SVGElement&&(l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l instanceof SVGRectElement&&["width","height"].forEach(function(p){var m=l.getAttribute(p);m&&l.style.setProperty(p,m)}))}return l instanceof Element?Promise.resolve().then(g).then(x).then(d).then(L).then(function(){return l}):l}return r||!t||t(n)?Promise.resolve(n).then(i).then(function(o){return s(n,o,t)}).then(function(o){return c(n,o)}):Promise.resolve()}function X(n){return M.resolveAll().then(function(t){var r=document.createElement("style");return n.appendChild(r),r.appendChild(document.createTextNode(t)),n})}function G(n){return V.inlineAll(n).then(function(){return n})}function z(n,t,r){return Promise.resolve(n).then(function(i){return i.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(i)}).then(a.escapeXhtml).then(function(i){return'<foreignObject x="0" y="0" width="100%" height="100%">'+i+"</foreignObject>"}).then(function(i){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+r+'">'+i+"</svg>"}).then(function(i){return"data:image/svg+xml;charset=utf-8,"+i})}function _(){function n(){var e="application/font-woff",u="image/jpeg";return{woff:e,woff2:e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:u,jpeg:u,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function t(e){var u=/\.([^\.\/]*?)$/g.exec(e);return u?u[1]:""}function r(e){var u=t(e).toLowerCase();return n()[u]||""}function i(e){return e.search(/^(data:)/)!==-1}function s(e){return new Promise(function(u){for(var f=window.atob(e.toDataURL().split(",")[1]),h=f.length,P=new Uint8Array(h),C=0;C<h;C++)P[C]=f.charCodeAt(C);u(new Blob([P],{type:"image/png"}))})}function c(e){return e.toBlob?new Promise(function(u){e.toBlob(u)}):s(e)}function o(e,u){var f=document.implementation.createHTMLDocument(),h=f.createElement("base");f.head.appendChild(h);var P=f.createElement("a");return f.body.appendChild(P),h.href=u,P.href=e,P.href}function l(){var e=0;return function(){function u(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}return"u"+u()+e++}}function g(e){return new Promise(function(u,f){var h=new Image;h.onload=function(){u(h)},h.onerror=f,h.src=e})}function x(e){var u=3e4;return E.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime()),new Promise(function(f){function h(){if(v.readyState===4){if(v.status!==200)return void(B?f(B):C("cannot fetch resource: "+e+", status: "+v.status));var S=new FileReader;S.onloadend=function(){var R=S.result.split(/,/)[1];f(R)},S.readAsDataURL(v.response)}}function P(){B?f(B):C("timeout of "+u+"ms occured while fetching resource: "+e)}function C(S){console.error(S),f("")}var v=new XMLHttpRequest;v.onreadystatechange=h,v.ontimeout=P,v.responseType="blob",v.timeout=u,v.open("GET",e,!0),v.send();var B;if(E.impl.options.imagePlaceholder){var A=E.impl.options.imagePlaceholder.split(/,/);A&&A[1]&&(B=A[1])}})}function d(e,u){return"data:"+u+";base64,"+e}function L(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function p(e){return function(u){return new Promise(function(f){setTimeout(function(){f(u)},e)})}}function m(e){for(var u=[],f=e.length,h=0;h<f;h++)u.push(e[h]);return u}function w(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")}function U(e){var u=T(e,"border-left-width"),f=T(e,"border-right-width");return e.scrollWidth+u+f}function y(e){var u=T(e,"border-top-width"),f=T(e,"border-bottom-width");return e.scrollHeight+u+f}function T(e,u){var f=window.getComputedStyle(e).getPropertyValue(u);return parseFloat(f.replace("px",""))}return{escape:L,parseExtension:t,mimeType:r,dataAsUrl:d,isDataUrl:i,canvasToBlob:c,resolveUrl:o,getAndEncode:x,uid:l(),delay:p,asArray:m,escapeXhtml:w,makeImage:g,width:U,height:y}}function J(){function n(c){return c.search(s)!==-1}function t(c){for(var o,l=[];(o=s.exec(c))!==null;)l.push(o[1]);return l.filter(function(g){return!a.isDataUrl(g)})}function r(c,o,l,g){function x(d){return new RegExp(`(url\\(['"]?)(`+a.escape(d)+`)(['"]?\\))`,"g")}return Promise.resolve(o).then(function(d){return l?a.resolveUrl(d,l):d}).then(g||a.getAndEncode).then(function(d){return a.dataAsUrl(d,a.mimeType(o))}).then(function(d){return c.replace(x(o),"$1"+d+"$3")})}function i(c,o,l){function g(){return!n(c)}return g()?Promise.resolve(c):Promise.resolve(c).then(t).then(function(x){var d=Promise.resolve(c);return x.forEach(function(L){d=d.then(function(p){return r(p,L,o,l)})}),d})}var s=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:i,shouldProcess:n,impl:{readUrls:t,inline:r}}}function W(){function n(){return t(document).then(function(r){return Promise.all(r.map(function(i){return i.resolve()}))}).then(function(r){return r.join(`
`)})}function t(){function r(c){return c.filter(function(o){return o.type===CSSRule.FONT_FACE_RULE}).filter(function(o){return D.shouldProcess(o.style.getPropertyValue("src"))})}function i(c){var o=[];return c.forEach(function(l){try{a.asArray(l.cssRules||[]).forEach(o.push.bind(o))}catch(g){console.log("Error while reading CSS rules from "+l.href,g.toString())}}),o}function s(c){return{resolve:function(){var o=(c.parentStyleSheet||{}).href;return D.inlineAll(c.cssText,o)},src:function(){return c.style.getPropertyValue("src")}}}return Promise.resolve(a.asArray(document.styleSheets)).then(i).then(r).then(function(c){return c.map(s)})}return{resolveAll:n,impl:{readAll:t}}}function K(){function n(r){function i(s){return a.isDataUrl(r.src)?Promise.resolve():Promise.resolve(r.src).then(s||a.getAndEncode).then(function(c){return a.dataAsUrl(c,a.mimeType(r.src))}).then(function(c){return new Promise(function(o,l){r.onload=o,r.onerror=l,r.src=c})})}return{inline:i}}function t(r){function i(s){var c=s.style.getPropertyValue("background");return c?D.inlineAll(c).then(function(o){s.style.setProperty("background",o,s.style.getPropertyPriority("background"))}).then(function(){return s}):Promise.resolve(s)}return r instanceof Element?i(r).then(function(){return r instanceof HTMLImageElement?n(r).inline():Promise.all(a.asArray(r.childNodes).map(function(s){return t(s)}))}):Promise.resolve(r)}return{inlineAll:t,impl:{newImage:n}}}var a=_(),D=J(),M=W(),V=K(),I={imagePlaceholder:void 0,cacheBust:!1},E={toSvg:b,toPng:F,toJpeg:$,toBlob:q,toPixelData:N,impl:{fontFaces:M,images:V,util:a,inliner:D,options:{}}};typeof module<"u"?module.exports=E:H.domtoimage=E})(this);
